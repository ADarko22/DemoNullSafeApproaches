# Null Safety Demo in Maven Project

This project demonstrates different scenarios for using **Null Safety** in a Maven-based Java project. The project contains three modules, each illustrating different aspects of
Null Safety:

1. **module-nullability** - Demonstrating the usage of `@javax.annotation.ParametersAreNonnullByDefault` and how **SpotBugs** detects nullable annotations.
2. **module-openapi-nullability** - Demonstrating how **Swagger**-generated classes handle nullability, and how **SpotBugs** detects missing nullable annotations in optional
   fields.
3. **module-thymeleaf-nullability** - Checking if **Thymeleaf** templates properly handle nullable properties without proper null checking.

---

## The Spotbugs Plugin

The [SpotBugs](https://spotbugs.github.io/) tool integrated as Maven Plugin allows to generate a report with vulnerability violations.

```
<plugin>
  <groupId>org.apache.maven.plugins</groupId>
  <artifactId>maven-project-info-reports-plugin</artifactId>
  <version>3.9.0</version>
</plugin>
```

### Nullability Violations

The tool integrates with Nullability annotations from Javax/Jakarta and includes in the generated report Nullability Violations.
This Demo exploits such a feature to encourage the use of Nullability annotations.

### Enforcing Bug and Vulnerability Checks in CI/CD

The spotbugs report can be analysed in a CI/CD step to prevent merging potential bugs, like Null Pointer Exceptions and Security Bugs.

---

## Project Overview

This Maven-based project serves as a demonstration of various **null safety** techniques and how static analysis tools, like **SpotBugs**, can help detect potential issues in Java
code.

In this project, we focus on:

- **Annotations** like `@ParametersAreNonnullByDefault` and nullable attributes.
- **Code analysis tools** like SpotBugs to detect issues related to nullability.
- **Auto-generated code**, such as Swagger-generated classes and Thymeleaf templates, and how they should adhere to null safety practices.

### module-nullability

This module shows the spotbugs report generated when running `mvn clean verigy site`:

1. The [package-info.java](module-nullability/src/main/java/edu/adarko22/package-info.java) is configured to enforce the annotation `@ParametersAreNonnullByDefault`.
2. The [NullabilityExample.java](module-nullability/src/main/java/edu/adarko22/NullabilityExample.java) violates this enforcement.
3. The generated report [spotbugsXml.xml](module-nullability/target/spotbugsXml.xml) reports the violation. Note that the IDE may also highlight it!

### module-openapi-nullability

The [openapi-generator-maven-plugin](https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin)
can be configured to generate Nullability annotations by configuring the plugin and using the attributes according to following the good practices.

#### Good Practices

1. Use `required` on parameters and properties of OpenAPI defined in the openapi.yaml file

2. Use OpenAPI 3.1
    - OpenAPI 3.1 uses JSON Schema 2020-12 which supports `nullable` more cleanly as:
       ```
       type: [string, 'null']
       ```
3. Use Additional Properties
    - `useBeanValidation = true`
    - `nullSafeAdditionalProps = true`
    - `useLombokAnnotations = true`

#### Altering Templates to enforce Null Safety

The above good practices may not be enough to generate _Null Safe APIs_, for example autogenerated _Pojos_ may miss `@NotNull` annotations.
Fortunately, OpenAPI allows to [specify desired templates](https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin#custom-generator)
for the autogenerated code. It requires to confgiure the `templateDirectory`> and provide the desired templates:

- [licenseInfo.mustache](module-openapi-nullability/sr[model.mustache](module-openapi-nullability/src/main/resources/openapi/templates/model.mustache)c/main/resources/openapi/templates/licenseInfo.mustache):
  required to use the templates from [OpenAPITools](https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator/src/main/resources/JavaSpring).
- [pojo.mustache](module-openapi-nullability/src/main/resources/openapi/templates/pojo.mustache): the updated template to generate _Pojos_ with:
  - `@NotNull` annotations on required parameters in setters (line 274) and constructors (line 115), for required properties
  - _fluent-style setters_ only for non-required (optional) properties (line 157)
  - _no-argument constructor_ only when there are no required properties (line 103)
