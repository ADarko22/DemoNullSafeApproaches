# OpenAPI Nullability Example

This module shows how to configure the  [openapi-generator-maven-plugin](https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin)
to generate _Null Safe APIs_ and how to use the SpotBugs plugin to detect nullability violations in the generated Java code.

## OpenAPI Generator Configuration

- The [openapi.yaml](src/main/resources/openapi/openapi.yaml) file defines the OpenAPI specification for the API.
    - Use `required` on parameters and properties of OpenAPI defined in the openapi.yaml file

    - Use OpenAPI 3.1
        - OpenAPI 3.1 uses JSON Schema 2020-12 which supports `nullable` more cleanly as:
           ```
           type: [string, 'null']
           ```
- The `openapi-generator-maven-plugin` can be configured with extra options to ensure the generated code is _Null Safe_ (see [pom.xml](pom.xml)):
    - Use `nullabeAnnotation = true` to generate `@javax.annotation.Nullable` annotations for nullable fields
    - Use `useNullable = true` to have `org.openapitools.jackson.nullable.JsonNullable<T>` for nullable fields, enabling explicit null handling
    - Use `useBeanValidation = true` to add Java Bean Validation annotations (like `@NotNull`, `@Size`) to models and parameters
    - Use `nullSafeAdditionalProps = true` to initialize the generated `Map<String, Object>` for additional properties

### Altering Templates to enforce Null Safety

The autogenerated _Pojos_ may miss `@Nonnull` annotations. Fortunately, OpenAPI allows
to [specify desired templates](https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin#custom-generator) for the autogenerated code. It
requires to configure the `templateDirectory` and provide the desired templates:

- [licenseInfo.mustache](src/main/resources/openapi/templates/licenseInfo.mustache)c/main/resources/openapi/templates/licenseInfo.mustache):
  required to use the templates from [OpenAPITools](https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator/src/main/resources/JavaSpring).
- [pojo.mustache](src/main/resources/openapi/templates/pojo.mustache): the updated template to generate _Pojos_ with:
    - `@javax.annotation.Nonnull` annotations on required parameters in setters (line 274) and constructors (line 115), for required properties
    - _fluent-style setters_ only for non-required (optional) properties (line 157)
    - _no-argument constructor_ only when there are no required properties (line 103)
- [beanValidation.mustache](src/main/resources/openapi/templates/beanValidation.mustache)
    - Updated to use `@javax.annotation.Nonnull` annotations

Reference to
the [default templates for Java Spring](https://github.com/OpenAPITools/openapi-generator/tree/a94b8f90ca764342965d9b4bbd91e73d36df80c8/modules/openapi-generator/src/main/resources/JavaSpring).

Note that as of April 2025 [Spotbugs donesn't support Jakarta yet](https://github.com/spotbugs/spotbugs/pull/3156).
For such a reason it doesn't support Spring Boot 3.x and the mustache files are using Javax annotations instead of Jakarta!

## Description of the Example

1. The [openapi.yaml](src/main/resources/openapi/openapi.yaml) defines an API with nullable and non-nullable parameters.
2. The `openapi-generator-maven-plugin` generates Java code from the OpenAPI specification.
3. The mustache files in the [templates](src/main/resources/openapi/templates) are customized to ensure that the generated code is annotated with `@javax.annotation.Nonnull`.
4. The [HelloApiController.java](src/main/java/edu/adarko22/HelloApiController.java) this enforcement.
5. The build fails on the `verify` phase due to the SpotBugs plugin configuration!
6. The generated report [spotbugsXml.xml](target/spotbugsXml.xml), in the `site` phase, reports the violation.

## Spotbugs Report

Spotbugs generates a report when running `mvn clean verify`. The report is available in the `target/site/spotbugs.html` directory.